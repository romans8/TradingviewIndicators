//@version=5
strategy(title="RSC Trend Trading Study", shorttitle="RSC TTS", overlay=true)

// Input parameters
lengthHigher = input.int(title="Buy Donchian Channel Period", defval=20, minval=1)
lengthLower = input.int(title="Buy Donchian Channel Period", defval=10, minval=1)
smaFast = input.int(title="SMA Fast", defval=50)
smaSlow = input.int(title="SMA Slow", defval=200)
buyOverSma50 = input.bool(title="Buy Over SMA 50 Close", defval=true)
buyOverSma50andSma200 = input.bool(title="Buy Over SMA 50 & 200 Close", defval=true)

// Calculate Donchian Channels
lower = ta.lowest(low, lengthLower)
upper = ta.highest(high, lengthHigher)

// Calculate SMAs
ma200 = ta.sma(close, smaSlow)
ma50 = ta.sma(close, smaFast)

// Plot Donchian Channels and SMAs
u = plot(upper, color=color.new(color.aqua, 0), linewidth=2)
l = plot(lower, color=color.new(color.orange, 0), linewidth=2)
plot(ma50, color=color.new(color.red, 0), linewidth=2)
plot(ma200, color=color.new(color.green, 0), linewidth=2)
fill(u, l, color=color.new(color.blue, 90))

// Initialize variables
var int rscTiActive = 0
var int rscTi = 0

// Conditions for buy and sell signals
if (buyOverSma50 and not buyOverSma50andSma200)
    if (high >= upper and close > ma50)
        rscTi := 1
        strategy.entry("Long", strategy.long)

if (buyOverSma50andSma200)
    if (high >= upper and close > ma200 and close > ma50)
        rscTi := 1
        strategy.entry("Long", strategy.long)

if (low <= lower)
    rscTi := -1
    strategy.entry("Short", strategy.short)

// Update the active signal
rscTiActive := (rscTi == 1 or rscTi == -1) ? rscTi : rscTiActive[1]
rscTi := (rscTiActive[1] == rscTi) ? 0 : rscTi

// Plot buy and sell signals
plotshape(series=(rscTi == 1), location=location.belowbar, style=shape.triangleup, color=color.new(color.aqua, 0), size=size.tiny, text="Buy", textcolor=color.new(color.aqua, 0))
plotshape(series=(rscTi == -1), location=location.abovebar, style=shape.triangledown, color=color.new(color.red, 0), size=size.tiny, text="Sell", textcolor=color.new(color.red, 0))
